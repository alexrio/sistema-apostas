import React, { Suspense, useEffect, useState } from "react";

function ErrorBoundary({ children }) {
  const [err, setErr] = useState(null);
  useEffect(() => {
    const onErr = (e) => setErr(e.error || new Error(String(e.message || e)));
    const onRej = (e) => setErr(e.reason || new Error("Promise rejeitada"));
    window.addEventListener("error", onErr);
    window.addEventListener("unhandledrejection", onRej);
    return () => {
      window.removeEventListener("error", onErr);
      window.removeEventListener("unhandledrejection", onRej);
    };
  }, []);
  if (err) {
    return (
      <div style={{ padding: 16, margin: 16, border: "1px solid #fecaca", background: "#fff1f2", borderRadius: 12 }}>
        <div style={{ fontWeight: 700, color: "#b91c1c", marginBottom: 8 }}>Erro em runtime</div>
        <pre style={{ whiteSpace: "pre-wrap" }}>{String(err.stack || err.message || err)}</pre>
      </div>
    );
  }
  return children;
}

const RealApp = React.lazy(() => import("./AppFull.jsx"));

export default function App(){
  return (
    <ErrorBoundary>
      <div style={{ padding: 12, color: "#334155", fontFamily: "system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif" }}>
        <div style={{ marginBottom: 8, fontSize: 13, opacity: 0.75 }}>Boot…</div>
        <Suspense fallback={<div style={{ padding: 8, borderRadius: 8, background: "#f1f5f9", display: "inline-block" }}>Carregando app…</div>}>
          <RealApp />
        </Suspense>
      </div>
    </ErrorBoundary>
  );
}
